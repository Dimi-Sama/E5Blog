<!-- 
⣿⣿⣿⡇⠄⣠⣬⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⡝⠙⣿⣷⡄⣹⣿⣿⣿⣿⠛⠛⠛⠛⠋⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠟⠿⡿⠿⠿⠿⠿⠿⠿⠿⢛⡻⡿⠿⣿⣿⣿⣿⣿⣿⣿
⣄⠄⡼⣿⣷⣿⣿⣿⡉⣿⣿⣿⣿⣿⡟⢿⣿⠄⠄⠄⠄⠘⣿⣿⣿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⠄⢱⡓⠉⠙⠙⠛⣻⠃⣿⣿⣿⣿⣿⠇⠸⣿⠄⠄⠄⠄⠄⠸⣿⡻⣿⣿⡘⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣿⣿⠟⡿⠿⣿⣿
⡠⠞⢯⣤⣠⣤⣾⣷⠄⣿⣿⣿⣿⣿⠄⠄⢻⠄⠄⠄⠄⠄⠄⠘⢧⠙⠻⣿⣄⠻⣿⣿⣿⣿⡟⣿⣿⣿⣿⠈⢿⣧⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣷⠋⡾⣇⣀⣸⣿
⣿⡿⣿⣿⢏⡿⠉⠉⠄⣿⣿⣿⣿⣿⠄⠄⠘⠒⠒⠒⠒⠒⠶⠶⠤⠄⠄⠈⠙⠂⠈⠙⠛⠋⠉⠉⠭⠿⠿⠶⠾⠛⠚⠛⠛⠛⠋⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⠿⡀⠄⠘⠉⠇⠂⠄⠄⣇⢻⣿⣿⣯⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⡆⠁⠄⠊⠙⠒⢄⣀⠄⣿⠐⢿⣿⣿⢠⣶⣦⣤⣀⣀⣀⣀⣀⣀⣀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣀⣀⣀⠄⢀⣀⣀⣤⣤⣤⣿⣿⡯⢿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⠄⠄⠄⣀⡀⠄⢈⣿⡆⣻⡇⠄⠛⣿⡆⠄⠉⠉⠙⠛⠛⠋⠉⠁⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠈⠉⠙⠛⠛⠛⠋⠉⠒⢰⣿⣿⡇⠘⣿⡇⣿⣿⣿⣿⣿⣿⣿
⣀⢠⠄⠁⠲⣻⣿⠿⠃⣿⣿⡀⠄⠘⢿⡀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⢀⣴⣿⡇⣿⣿⣿⣿⣿⣿⣿
⣿⣷⣀⠄⣀⢟⡩⣲⠄⣿⣿⣿⣤⣀⠈⠻⣄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣼⣿⣿⣿⣿⣿⡇⣹⣿⣿⣿⣿⣿⣿
⣵⣝⢿⣟⡯⠭⡹⣿⣄⣿⣿⣿⣿⣿⣷⡀⠈⠳⢄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣿⣿⣿⣿⣿⣿⡇⢮⣭⡯⠍⠹⣻⣿
⣿⣿⣿⣿⡛⣫⣴⣿⠌⢹⢿⣿⣿⣿⣿⣿⡄⠄⠄⠈⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣾⣿⣿⣿⣿⣿⣿⡇⣚⠗⠄⠄⣰⣿⣿
⡟⠏⠉⠉⠻⣦⡉⢩⠤⠈⠉⠄⣩⡿⠛⠛⠛⠂⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠛⠛⠛⠛⠛⣛⣛⣛⣃⣿⣷⣶⣿⣿⣿⣿
⣩⠅⠄⠄⢺⠿⠛⢦⣇⢠⠈⣨⣾⣷⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣥⣤
⣣⣴⣇⢸⠟⣄⣀⣸⣿⣿⣿⣿⣿⣯⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠺⣿⣦⣄⣀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢠⣶⣶⢿⣿⣿⣿⣟⣿⢿⣿⣿⣿⣿⣿⣿ 
-->
<?php
session_start();


    $user = $_POST["txtUser"];	
    $mdp = $_POST["txtMdp"];
    require "../lib/dbConnect.php";
    $bd = new DbConnect();
    $conn = $bd->connect();

    $sql = "SELECT * FROM utilisateurs WHERE username = :user";
        // Pour éviter les injections SQL
        $result = $conn->prepare($sql);			
        $result->bindparam(':user',$user);
        $result->execute();          
        $line = $result->fetch();
        
if (!$line) {
    // Utilisateur non trouvé ($line ne contient pas d'enregistrement)
    header("Location: form-admin.php?emty=TRUE");
} else {
    // Utilisateur trouvé
    $mdpBD = $line['mdp'];
    if(password_verify($mdp,$mdpBD)) {
    
        // Mémorisation des infos utilisateur
        $_SESSION["User"] = $line['id']; 
        $_SESSION["Username"] = $line['username']; 
        
        //Test pour voir si l'utilisateur est un modérateur 
        $sql = "SELECT * FROM moderateurs WHERE idUser = :idUser";
        // Pour éviter les injections SQL
        $result = $conn->prepare($sql);			
        $result->bindparam(':idUser', $_SESSION["User"]);
        $result->execute();          
        $line = $result->fetch();
        if (!$line) {
            header("Location: ../index.php");
        }else {
            $_SESSION["Modo"] = TRUE;
            header("Location: ../index.php");
        }
       
    }

}

?>