<!-- 
⣿⣿⣿⡇⠄⣠⣬⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⡝⠙⣿⣷⡄⣹⣿⣿⣿⣿⠛⠛⠛⠛⠋⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠟⠿⡿⠿⠿⠿⠿⠿⠿⠿⢛⡻⡿⠿⣿⣿⣿⣿⣿⣿⣿
⣄⠄⡼⣿⣷⣿⣿⣿⡉⣿⣿⣿⣿⣿⡟⢿⣿⠄⠄⠄⠄⠘⣿⣿⣿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⠄⢱⡓⠉⠙⠙⠛⣻⠃⣿⣿⣿⣿⣿⠇⠸⣿⠄⠄⠄⠄⠄⠸⣿⡻⣿⣿⡘⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣿⣿⠟⡿⠿⣿⣿
⡠⠞⢯⣤⣠⣤⣾⣷⠄⣿⣿⣿⣿⣿⠄⠄⢻⠄⠄⠄⠄⠄⠄⠘⢧⠙⠻⣿⣄⠻⣿⣿⣿⣿⡟⣿⣿⣿⣿⠈⢿⣧⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣷⠋⡾⣇⣀⣸⣿
⣿⡿⣿⣿⢏⡿⠉⠉⠄⣿⣿⣿⣿⣿⠄⠄⠘⠒⠒⠒⠒⠒⠶⠶⠤⠄⠄⠈⠙⠂⠈⠙⠛⠋⠉⠉⠭⠿⠿⠶⠾⠛⠚⠛⠛⠛⠋⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⠿⡀⠄⠘⠉⠇⠂⠄⠄⣇⢻⣿⣿⣯⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⡆⠁⠄⠊⠙⠒⢄⣀⠄⣿⠐⢿⣿⣿⢠⣶⣦⣤⣀⣀⣀⣀⣀⣀⣀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣀⣀⣀⠄⢀⣀⣀⣤⣤⣤⣿⣿⡯⢿⣿⡇⣿⣿⣿⣿⣿⣿⣿
⠄⠄⠄⣀⡀⠄⢈⣿⡆⣻⡇⠄⠛⣿⡆⠄⠉⠉⠙⠛⠛⠋⠉⠁⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠈⠉⠙⠛⠛⠛⠋⠉⠒⢰⣿⣿⡇⠘⣿⡇⣿⣿⣿⣿⣿⣿⣿
⣀⢠⠄⠁⠲⣻⣿⠿⠃⣿⣿⡀⠄⠘⢿⡀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⢀⣴⣿⡇⣿⣿⣿⣿⣿⣿⣿
⣿⣷⣀⠄⣀⢟⡩⣲⠄⣿⣿⣿⣤⣀⠈⠻⣄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣼⣿⣿⣿⣿⣿⡇⣹⣿⣿⣿⣿⣿⣿
⣵⣝⢿⣟⡯⠭⡹⣿⣄⣿⣿⣿⣿⣿⣷⡀⠈⠳⢄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣿⣿⣿⣿⣿⣿⡇⢮⣭⡯⠍⠹⣻⣿
⣿⣿⣿⣿⡛⣫⣴⣿⠌⢹⢿⣿⣿⣿⣿⣿⡄⠄⠄⠈⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣾⣿⣿⣿⣿⣿⣿⡇⣚⠗⠄⠄⣰⣿⣿
⡟⠏⠉⠉⠻⣦⡉⢩⠤⠈⠉⠄⣩⡿⠛⠛⠛⠂⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠛⠛⠛⠛⠛⣛⣛⣛⣃⣿⣷⣶⣿⣿⣿⣿
⣩⠅⠄⠄⢺⠿⠛⢦⣇⢠⠈⣨⣾⣷⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣥⣤
⣣⣴⣇⢸⠟⣄⣀⣸⣿⣿⣿⣿⣿⣯⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠺⣿⣦⣄⣀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢠⣶⣶⢿⣿⣿⣿⣟⣿⢿⣿⣿⣿⣿⣿⣿ 
-->
<?php
session_start();
include 'lib/dbConnect.php';
$bd = new DbConnect();
$conn = $bd->connect();

$idArt = $_GET['idArticle'];

$sql = "SELECT * FROM article WHERE id= :id";
                $req = $conn->prepare($sql);
                $req->bindParam(':id', $idArt);
                $req->execute();
                $art = $req->fetch(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="styles/articlesView.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $art['titre'] ?></title>
</head>
<body>
    <div class="background">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>

        <?php require_once "lib/navbar.php" ?>
    <div class="containerArticle">
        <div>
        <h1 class="titreArticle"><?php echo $art['titre'] ?></h1>
        <img class="viewArticle" src="images/<?php echo $art['image'] ?>" alt="Image" class="image">
        <p class="textArticle"><?php 	setlocale(LC_TIME, 'fr'); echo ucfirst(strftime('%d %B %Y à %R',strtotime($art['datePublication'])));  ?></p>
        <?php 

                if(!isset($_SESSION['User'])){
                    echo " <div class='likes'><a  href='login-form.php'><img height='15px' src='https://cdn-icons-png.flaticon.com/512/1077/1077035.png'><p>  " . $art['likeTotal'] . "</p></a> </div>";
                }else{

                $sql = "SELECT idUser FROM likes WHERE idArticle = :idArt";
                // Pour éviter les injections SQL
                $result = $conn->prepare($sql);
                $result->bindParam(':idArt', $idArt);
                $result->execute();
                $users = $result->fetchAll(PDO::FETCH_ASSOC);
                $like = FALSE;
                foreach ($users as $user) {
                    if ($user['idUser'] == $_SESSION["User"]) {
                        $like = 'TRUE';
                    }
                }
                if ($like == 'TRUE') {
                    echo " <div class='likes'> <a href='like.php?like=TRUE&idUser=" . $_SESSION["User"] . "&idArt=" . $idArt . "'><img height='15px' src='https://cdn-icons-png.flaticon.com/512/2107/2107845.png'><p>  " . $art['likeTotal'] . "</p></a> </div>";
                } else {
                    echo " <div class='likes'><a  href='like.php?idUser=" . $_SESSION["User"] . "&idArt=" . $idArt . "'><img height='15px' src='https://cdn-icons-png.flaticon.com/512/1077/1077035.png'><p>  " . $art['likeTotal'] . "</p></a> </div>";
                }
            }

                ?>
                <?php echo $art['contenu'] ?>
                <?php if(isset($_SESSION['Modo'])){
            echo '<a href="updatePost.php?idArticle=' . $art['id'] . '">Modifier l\'article</a> ';
            echo '<a href="deletePost.php?idArticle=' . $art['id'] . '">Supprimer l\'article</a>';

        } ?>
            </div>
        </div>
    </div>
    </div>
</body>
</html>